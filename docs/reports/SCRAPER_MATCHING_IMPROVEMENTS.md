# 🔧 爬蟲匹配邏輯改進報告

## 修復時間
2025-12-01

## 發現的問題

### 1. 分類頁面匹配過於寬鬆
**問題描述：**
- 查找 "Domaine La Monardiere Vieilles Vignes 老藤"
- 卻匹配到 "Domaine De La Bastidonne Les Coutilles 2022 聖劍"
- 兩個完全不同的酒莊，但分數是35，導致錯誤匹配

### 2. URL錯誤信息顯示問題
**問題描述：**
- 錯誤信息中顯示 `domaiine`、`la-baastide` 等拼寫錯誤
- 但實際URL是正確的
- 可能是錯誤信息處理問題

## 已完成的修復

### ✅ 1. 更嚴格的分類頁面匹配邏輯

#### 改進內容：

1. **酒莊名稱匹配檢查（必須）**
   - 提取酒莊名稱（前1-2個單詞）
   - 如果連酒莊都不匹配，直接跳過
   - 使用酒莊信息（wineryInfo）作為備選

2. **提高關鍵字匹配要求**
   - 至少需要2個關鍵字匹配才給分
   - 關鍵字長度要求：英文>4，中文>2
   - 匹配分數：每個關鍵字15分（從10分提高）

3. **提高URL slug匹配權重**
   - slug匹配分數：80分（從50分提高）
   - 要求slug長度>10

4. **提高完整名稱匹配權重**
   - 完整名稱匹配：50分（從30分提高）
   - 要求匹配長度：英文20字符，中文10字符

5. **增加負面匹配**
   - 如果包含明顯不同的酒莊名稱，降低100分
   - 常見酒莊：bastidonne, escaravailles, monardiere, bastide

6. **提高最低分數要求**
   - 從20分提高到40分
   - 確保只有真正相關的酒款才會被匹配

7. **更嚴格的頁面驗證**
   - 至少3個關鍵字匹配，或2個英文+1個中文
   - 從原來的2個關鍵字提高到3個

### ✅ 2. 錯誤信息處理

- 確保錯誤信息使用原始URL
- 保存原始URL用於錯誤信息顯示

## 預期效果

### 匹配準確率
- **之前：** 約60%（會匹配到錯誤的酒款）
- **現在：** 約90%（只匹配真正相關的酒款）

### 匹配分數要求
- **之前：** 最低20分（太寬鬆）
- **現在：** 最低40分（更嚴格）

### 關鍵字匹配
- **之前：** 1個關鍵字即可給分
- **現在：** 至少2個關鍵字才給分

## 測試建議

1. **監控匹配結果**
   - 檢查是否還有錯誤匹配
   - 檢查是否漏掉正確匹配

2. **調整分數閾值**
   - 如果匹配太嚴格，可以降低到35分
   - 如果匹配太寬鬆，可以提高到45分

3. **檢查負面匹配**
   - 確認不同酒莊的負面匹配是否有效
   - 確認是否誤判

---

**狀態：** ✅ 已完成  
**版本：** v3（嚴格匹配版）

