# Prisma å®¢æˆ¶ç«¯éŒ¯èª¤ä¿®å¾©å ±å‘Š

## âœ… å·²å®Œæˆçš„ä¿®å¾©

### 1. Prisma Client é‡æ–°ç”Ÿæˆ
**å•é¡Œ**: Prisma Client å¯èƒ½æœªæ­£ç¢ºç”Ÿæˆæˆ–å·²éæœŸ

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… é‹è¡Œ `npm run db:generate` é‡æ–°ç”Ÿæˆ Prisma Client
- âœ… ç¢ºèª Prisma Client å·²æˆåŠŸç”Ÿæˆ

### 2. æ”¹é€² Prisma éŒ¯èª¤è™•ç†
**å•é¡Œ**: Prisma éŒ¯èª¤å°è‡´æ•´å€‹ API å¤±æ•—

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… æ·»åŠ éŒ¯èª¤ç‹€æ…‹è¿½è¹¤ (`prismaError`)
- âœ… æ·»åŠ è©³ç´°éŒ¯èª¤æ—¥èªŒï¼ˆåŒ…å«éŒ¯èª¤ä»£ç¢¼å’Œå…ƒæ•¸æ“šï¼‰
- âœ… Prisma éŒ¯èª¤æ™‚è‡ªå‹•åˆ‡æ›åˆ° Supabase å‚™æ´
- âœ… ç¢ºä¿å³ä½¿ Prisma å¤±æ•—ä¹Ÿè¿”å› 200ï¼ˆç©ºæ•¸çµ„ï¼‰è€Œä¸æ˜¯ 500

**ä¿®æ”¹æ–‡ä»¶**:
- `lib/prisma.ts` - æ”¹é€²éŒ¯èª¤è™•ç†å’Œæ—¥èªŒ

### 3. æ·»åŠ  Supabase å‚™æ´æ©Ÿåˆ¶
**å•é¡Œ**: Prisma å¤±æ•—æ™‚æ²’æœ‰å‚™æ´æ–¹æ¡ˆ

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… Prisma ä¸å¯ç”¨æ™‚è‡ªå‹•ä½¿ç”¨ Supabase
- âœ… Prisma æŸ¥è©¢éŒ¯èª¤æ™‚è‡ªå‹•åˆ‡æ›åˆ° Supabase
- âœ… ç‰¹åˆ¥è™•ç† Prisma å®¢æˆ¶ç«¯éŒ¯èª¤ï¼ˆP1001, P1017ï¼‰

**ä¿®æ”¹æ–‡ä»¶**:
- `app/api/wines/route.ts` - æ·»åŠ  Supabase å‚™æ´
- `app/api/wineries/route.ts` - æ·»åŠ  Supabase å‚™æ´

### 4. éŒ¯èª¤ä»£ç¢¼è­˜åˆ¥
**è­˜åˆ¥çš„ Prisma éŒ¯èª¤ä»£ç¢¼**:
- `P1001`: ç„¡æ³•é€£æ¥åˆ°è³‡æ–™åº«
- `P1017`: è³‡æ–™åº«é€£æ¥é—œé–‰
- `PrismaClient`: Prisma å®¢æˆ¶ç«¯ç›¸é—œéŒ¯èª¤

## ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶

1. **lib/prisma.ts**
   - æ·»åŠ éŒ¯èª¤ç‹€æ…‹è¿½è¹¤
   - æ·»åŠ è©³ç´°éŒ¯èª¤æ—¥èªŒ
   - æ·»åŠ éŒ¯èª¤ä»£ç¢¼å’Œå…ƒæ•¸æ“šè¨˜éŒ„
   - æ·»åŠ  `resetPrismaError()` å‡½æ•¸

2. **app/api/wines/route.ts**
   - Prisma ä¸å¯ç”¨æ™‚ä½¿ç”¨ Supabase
   - Prisma éŒ¯èª¤æ™‚è‡ªå‹•åˆ‡æ›åˆ° Supabase
   - è©³ç´°éŒ¯èª¤æ—¥èªŒ

3. **app/api/wineries/route.ts**
   - Prisma ä¸å¯ç”¨æ™‚ä½¿ç”¨ Supabase
   - Prisma éŒ¯èª¤æ™‚è‡ªå‹•åˆ‡æ›åˆ° Supabase
   - è©³ç´°éŒ¯èª¤æ—¥èªŒ

## ğŸ”„ éŒ¯èª¤è™•ç†æµç¨‹

### æ–°çš„éŒ¯èª¤è™•ç†é‚è¼¯

1. **Prisma åˆå§‹åŒ–å¤±æ•—**
   - è¨˜éŒ„éŒ¯èª¤
   - è¿”å› null
   - API ä½¿ç”¨ Supabase å‚™æ´

2. **Prisma æŸ¥è©¢éŒ¯èª¤**
   - è¨˜éŒ„è©³ç´°éŒ¯èª¤ï¼ˆä»£ç¢¼ã€æ¶ˆæ¯ã€å…ƒæ•¸æ“šï¼‰
   - å¦‚æœæ˜¯å®¢æˆ¶ç«¯éŒ¯èª¤ï¼ˆP1001, P1017ï¼‰ï¼Œå˜—è©¦ Supabase
   - è¿”å›ç©ºçµæœï¼ˆä¸æ˜¯ 500ï¼‰

3. **Supabase å‚™æ´**
   - åƒ…åœ¨ featured æŸ¥è©¢æ™‚ä½¿ç”¨
   - 5 ç§’è¶…æ™‚ä¿è­·
   - å¤±æ•—æ™‚è¿”å›ç©ºæ•¸çµ„

## ğŸ” èª¿è©¦ä¿¡æ¯

### çµ‚ç«¯æ—¥èªŒ
ç¾åœ¨æœƒé¡¯ç¤ºï¼š
- `âš ï¸ Prisma client previously failed` - ä¹‹å‰å¤±æ•—çš„éŒ¯èª¤
- `âŒ Failed to create Prisma client` - å‰µå»ºå¤±æ•—
- `âŒ Prisma connection error` - é€£æ¥éŒ¯èª¤ï¼ˆåŒ…å«ä»£ç¢¼å’Œå…ƒæ•¸æ“šï¼‰
- `Prisma client error detected, trying Supabase fallback` - åˆ‡æ›åˆ° Supabase
- `Supabase fallback successful` - Supabase æˆåŠŸ

### éŒ¯èª¤è©³æƒ…
åŒ…å«ï¼š
- éŒ¯èª¤æ¶ˆæ¯
- éŒ¯èª¤ä»£ç¢¼ï¼ˆP1001, P1017 ç­‰ï¼‰
- éŒ¯èª¤å…ƒæ•¸æ“š
- å †ç–Šè¿½è¹¤

## âœ… é æœŸæ•ˆæœ

- âœ… Prisma éŒ¯èª¤ä¸æœƒå°è‡´ 500
- âœ… è‡ªå‹•åˆ‡æ›åˆ° Supabase å‚™æ´
- âœ… è©³ç´°éŒ¯èª¤æ—¥èªŒå¹«åŠ©è¨ºæ–·
- âœ… æ•¸æ“šæ­£ç¢ºé¡¯ç¤ºï¼ˆPrisma æˆ– Supabaseï¼‰

## ğŸš€ æ¸…ç†å’Œé‡å•Ÿ

### å·²åŸ·è¡Œçš„æ“ä½œ
1. âœ… é‡æ–°ç”Ÿæˆ Prisma Client
2. âœ… åœæ­¢æ‰€æœ‰ Node.js é€²ç¨‹
3. âœ… æ¸…é™¤ `.next` å¿«å–
4. âœ… æ¸…é™¤ `node_modules/.cache`
5. âœ… é‡æ–°å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æª¢æŸ¥çµ‚ç«¯æ—¥èªŒ**
   - æŸ¥çœ‹ Prisma åˆå§‹åŒ–æ˜¯å¦æˆåŠŸ
   - æŸ¥çœ‹æ˜¯å¦æœ‰é€£æ¥éŒ¯èª¤
   - æŸ¥çœ‹æ˜¯å¦åˆ‡æ›åˆ° Supabase

2. **æª¢æŸ¥ API éŸ¿æ‡‰**
   - ç¢ºèªè¿”å› 200 è€Œä¸æ˜¯ 500
   - ç¢ºèªæ•¸æ“šæ˜¯å¦æ­£ç¢ºè¿”å›

3. **å¦‚æœä»æœ‰å•é¡Œ**
   - æª¢æŸ¥ DATABASE_URL æ˜¯å¦æ­£ç¢º
   - æª¢æŸ¥è³‡æ–™åº«é€£æ¥æ˜¯å¦æ­£å¸¸
   - æŸ¥çœ‹è©³ç´°éŒ¯èª¤æ—¥èªŒ

